<view class="container"><custom-nav-bar vue-id="be4d2d3c-1" title="AI助手" subtitle="智能问答" show-back="{{true}}" bind:__l="__l"></custom-nav-bar><view class="{{['chat-sidebar',(showSidebar)?'sidebar-open':'']}}"><view class="sidebar-header"><text class="sidebar-title"><image class="sidebar-title-icon" src="/static/icons/chat-history.png"></image>会话历史</text><view data-event-opts="{{[['tap',[['toggleSidebar',['$event']]]]]}}" class="sidebar-close" bindtap="__e"><image class="close-icon" src="/static/icons/close.png"></image></view></view><view class="chat-history-list"><block wx:if="{{loadingHistory}}"><view class="loading-message"><view class="loading-dots"><view class="dot"></view><view class="dot"></view><view class="dot"></view></view></view></block><block wx:else><block wx:if="{{$root.g0===0}}"><view class="empty-history"><text>暂无历史会话</text></view></block><block wx:else><block wx:for="{{$root.l0}}" wx:for-item="session" wx:for-index="index" wx:key="id"><view data-event-opts="{{[['tap',[['selectSession',['$0'],[[['chatHistory','id',session.$orig.id]]]]]]]}}" class="{{['history-item',(currentSession&&currentSession.id===session.$orig.id)?'active-session':'']}}" bindtap="__e"><view class="history-title-row"><image class="history-item-icon" src="/static/icons/session.png"></image><text class="history-title">{{"会话 "+(index+1)}}</text></view><view class="history-date-row"><image class="history-date-icon" src="/static/icons/calendar.png"></image><text class="history-date">{{session.m0}}</text></view></view></block></block></block></view><view data-event-opts="{{[['tap',[['startNewChat',['$event']]]]]}}" class="new-chat" bindtap="__e"><image class="new-chat-icon" src="/static/icons/new-chat.png"></image><text class="new-chat-text">新建会话</text></view></view><view class="main-content"><view class="{{['ai-content',(showSidebar)?'with-sidebar':'']}}"><view class="header-actions"><view data-event-opts="{{[['tap',[['toggleSidebar',['$event']]]]]}}" class="history-btn" bindtap="__e"><image class="history-icon" src="/static/icons/history.png"></image><text class="history-text">历史记录</text></view></view><view class="chat-container"><scroll-view class="chat-messages vue-ref" scroll-y="{{true}}" scroll-top="{{scrollTop}}" scroll-with-animation="{{true}}" enable-flex="true" data-ref="chatScroll" data-event-opts="{{[['scrolltoupper',[['loadMoreMessages',['$event']]]]]}}" bindscrolltoupper="__e"><view class="messages-wrapper"><block wx:for="{{localMessageList}}" wx:for-item="message" wx:for-index="index"><view class="{{['message-container',(message.role==='user')?'user-container':'',(message.role==='ai')?'ai-container':'']}}"><view class="{{['message',message.role==='user'?'user':'ai']}}"><block wx:if="{{message.role==='ai'}}"><image class="message-avatar" src="/static/avatars/ai-avatar.png"></image></block><view class="message-content"><text class="message-text">{{message.content}}</text></view></view></view></block></view></scroll-view><view class="chat-input-area"><input class="chat-input" type="text" placeholder="请输入您的问题..." disabled="{{isLoading}}" data-event-opts="{{[['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','userInput','$event',[]]]]]]}}" value="{{userInput}}" bindconfirm="__e" bindinput="__e"/><button class="send-btn" disabled="{{$root.g1}}" data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" bindtap="__e"><block wx:if="{{!isLoading}}"><image class="send-icon" src="/static/icons/send.png"></image></block><block wx:else><image class="loading-icon" src="/static/icons/loading.png"></image></block></button></view></view></view></view><block wx:if="{{showSidebar}}"><view data-event-opts="{{[['tap',[['toggleSidebar',['$event']]]]]}}" class="sidebar-overlay" bindtap="__e"></view></block></view>