<view class="container"><custom-nav-bar vue-id="c1c3f95e-1" title="店铺详情" subtitle="店铺商品" show-back="{{true}}" bind:__l="__l"></custom-nav-bar><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="back-button" bindtap="__e"><text class="back-arrow">←</text><text class="back-text">返回</text></view><block wx:if="{{loading&&!shop}}"><view class="loading-container"><view class="loading-spinner"></view><text class="loading-text">加载中...</text></view></block><block wx:else><block wx:if="{{!shop}}"><view class="empty-container"><text class="empty-text">未找到店铺</text></view></block><block wx:else><block><view class="shop-info-card"><view class="shop-header"><image class="shop-logo" src="{{shop.avatar||shop.logo||'https://ykhyyy.oss-cn-beijing.aliyuncs.com/ht.jpg'}}" mode="aspectFill"></image><view class="shop-details"><view class="shop-name-row"><text class="shop-name">{{shop.name}}</text><view class="shop-badges"><block wx:if="{{shop.isOfficial}}"><text class="shop-badge official">官方</text></block><block wx:if="{{shop.isNew}}"><text class="shop-badge new">新店</text></block></view></view><view class="shop-rating"><text class="rating-score">{{shop.rating||'5.0'}}</text><view class="rating-stars"><block wx:for="{{$root.l0}}" wx:for-item="n" wx:for-index="__i0__" wx:key="$orig"><text class="{{['star',(n.$orig<=n.g0)?'active':'']}}">★</text></block></view><text class="rating-count">{{(shop.ratingCount||0)+"条评价"}}</text></view><text class="shop-description">{{shop.description||'暂无描述'}}</text></view></view></view><view class="shop-tabs"><view data-event-opts="{{[['tap',[['goToShopReviews',['$event']]]]]}}" class="shop-tab-item" bindtap="__e"><view class="tab-icon">🔍</view><text class="tab-text">探店</text></view><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="shop-tab-item" bindtap="__e"><view class="tab-icon">🎟️</view><text class="tab-text">优惠券</text><block wx:if="{{$root.g1>0}}"><view class="tab-badge">{{$root.g2}}</view></block></view><view class="shop-tab-item active"><view class="tab-icon">🛍️</view><text class="tab-text">商品</text></view><view class="shop-tab-item"><view class="tab-icon">🏪</view><text class="tab-text">店铺</text></view></view><block wx:if="{{showCoupons}}"><view class="coupon-popup"><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" class="coupon-popup-mask" bindtap="__e"></view><view class="coupon-popup-content"><view class="coupon-popup-header"><text class="coupon-popup-title">店铺优惠券</text><text data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" class="coupon-popup-close" bindtap="__e">×</text></view><scroll-view class="coupon-list" scroll-y="{{true}}"><block wx:if="{{loadingCoupons}}"><view class="loading-container small"><view class="loading-spinner small"></view><text class="loading-text">加载优惠券...</text></view></block><block wx:else><block wx:if="{{$root.g3===0}}"><view class="empty-container small"><text class="empty-text">暂无优惠券</text></view></block><block wx:else><view class="coupon-items"><block wx:for="{{$root.l1}}" wx:for-item="coupon" wx:for-index="index"><view class="{{['coupon-item',(coupon.$orig.type==='SPEED_KILL')?'coupon-speedkill':'',(coupon.m0)?'coupon-disabled':'']}}"><view class="coupon-left"><view class="coupon-value"><block wx:if="{{coupon.$orig.type!=='DISCOUNT'}}"><text class="coupon-currency">¥</text></block><text class="coupon-amount">{{coupon.m1}}</text><block wx:if="{{coupon.$orig.type==='DISCOUNT'}}"><text class="coupon-unit">折</text></block></view><block wx:if="{{coupon.$orig.minAmount&&coupon.$orig.minAmount>0}}"><text class="coupon-condition">{{"满"+coupon.$orig.minAmount+"元可用"}}</text></block></view><view class="coupon-middle"><text class="coupon-name">{{coupon.$orig.name||'店铺优惠券'}}</text><text class="coupon-desc">{{coupon.$orig.description||'购物可用'}}</text><text class="coupon-time">{{coupon.m2}}</text><block wx:if="{{coupon.$orig.type==='SPEED_KILL'}}"><text class="coupon-tag">秒杀</text></block><block wx:else><block wx:if="{{coupon.$orig.type==='DISCOUNT'}}"><text class="coupon-tag">折扣券</text></block><block wx:else><text class="coupon-tag">满减券</text></block></block></view><view class="coupon-right"><button class="coupon-btn" disabled="{{coupon.m3}}" data-event-opts="{{[['tap',[['claimCoupon',['$0'],[[['coupons','id||index',coupon.$orig.id||index]]]]]]]}}" bindtap="__e"><block wx:if="{{coupon.$orig.userClaimed}}"><text>已领取</text></block><block wx:else><block wx:if="{{coupon.m4}}"><text>立即抢</text></block><block wx:else><block wx:if="{{coupon.m5}}"><text>已结束</text></block><block wx:else><text>立即领</text></block></block></block></button><block wx:if="{{coupon.$orig.totalCount&&coupon.$orig.totalCount>0}}"><text class="coupon-limit">{{"剩余: "+(coupon.$orig.totalCount-(coupon.$orig.usedCount||0))}}</text></block></view></view></block></view></block></block></scroll-view></view></view></block><view class="search-box"><view class="search-input-wrapper"><image class="search-icon" src="https://ykhyyy.oss-cn-beijing.aliyuncs.com/ht.jpg"></image><input class="search-input" type="text" placeholder="搜索店内商品" data-event-opts="{{[['confirm',[['searchProducts',['$event']]]],['input',[['__set_model',['','searchText','$event',[]]]]]]}}" value="{{searchText}}" bindconfirm="__e" bindinput="__e"/></view></view><view class="content-layout"><scroll-view class="category-sidebar" scroll-y="{{true}}"><block wx:if="{{loadingCategories}}"><view class="loading-container small"><view class="loading-spinner small"></view><text class="loading-text">加载分类...</text></view></block><block wx:else><block wx:if="{{$root.g4===0}}"><view class="empty-container small"><text class="empty-text">暂无分类</text></view></block><block wx:else><view class="category-list"><block wx:for="{{categories}}" wx:for-item="category" wx:for-index="index"><view data-event-opts="{{[['tap',[['selectCategory',['$0'],[[['categories','id||index',category.id||index,'id']]]]]]]}}" class="{{['category-item',(selectedCategoryId===category.id)?'active':'']}}" bindtap="__e"><text class="category-name">{{category.name}}</text></view></block></view></block></block></scroll-view><scroll-view class="product-area" scroll-y="{{true}}" data-event-opts="{{[['scrolltolower',[['loadMore',['$event']]]]]}}" bindscrolltolower="__e"><block wx:if="{{$root.g5}}"><view class="loading-container"><view class="loading-spinner"></view><text class="loading-text">加载商品中...</text></view></block><block wx:else><block wx:if="{{$root.g6===0}}"><view class="empty-container"><text class="empty-text">暂无商品</text></view></block><block wx:else><view class="products-grid"><block wx:for="{{products}}" wx:for-item="product" wx:for-index="index"><view data-event-opts="{{[['tap',[['viewProductDetail',['$0'],[[['products','id||index',product.id||index,'id']]]]]]]}}" class="product-card" bindtap="__e"><image class="product-image" src="{{product.image||'https://ykhyyy.oss-cn-beijing.aliyuncs.com/ht.jpg'}}" mode="aspectFill"></image><view class="product-info"><text class="product-name">{{product.name}}</text><view class="product-price-row"><text class="product-price">{{"¥"+(product.price||'0.00')}}</text><text class="product-sold">{{"已售"+(product.sales||0)+"件"}}</text></view></view><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="add-to-cart-wrapper" catchtap="__e"><view data-event-opts="{{[['tap',[['addToCart',[index]]]]]}}" class="add-to-cart" catchtap="__e"><text class="add-icon">+</text></view></view></view></block></view></block></block><block wx:if="{{hasMore}}"><view data-event-opts="{{[['tap',[['loadMore',['$event']]]]]}}" class="load-more" bindtap="__e"><block wx:if="{{!loadingMore}}"><text>加载更多</text></block><block wx:else><view class="loading-spinner small"></view></block></view></block><block wx:else><view class="no-more"><text>没有更多商品了</text></view></block></scroll-view></view><block wx:if="{{$root.g7>0}}"><view class="cart-bar"><view class="cart-info"><view data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" class="cart-icon-wrapper" bindtap="__e"><view class="cart-icon">🛒</view><view class="cart-count">{{getTotalCount}}</view></view><view class="cart-total"><text class="total-label">合计:</text><text class="total-price">{{"¥"+getTotalPrice}}</text></view></view><button data-event-opts="{{[['tap',[['checkout',['$event']]]]]}}" class="checkout-btn" bindtap="__e">去结算</button></view></block><block wx:if="{{$root.g8}}"><view class="cart-detail-popup"><view class="cart-detail-content"><view class="cart-detail-header"><text class="cart-detail-title">购物车</text><text data-event-opts="{{[['tap',[['clearCart',['$event']]]]]}}" class="cart-detail-clear" bindtap="__e">清空</text></view><scroll-view class="cart-detail-list" scroll-y="{{true}}"><block wx:for="{{cartItems}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="cart-item"><image class="cart-item-image" src="{{item.image||'https://ykhyyy.oss-cn-beijing.aliyuncs.com/ht.jpg'}}" mode="aspectFill"></image><view class="cart-item-info"><text class="cart-item-name">{{item.name}}</text><text class="cart-item-price">{{"¥"+item.price}}</text></view><view class="cart-item-controls"><view data-event-opts="{{[['tap',[['decreaseQuantity',[index]]]]]}}" class="quantity-btn minus" bindtap="__e">-</view><text class="quantity-text">{{item.quantity}}</text><view data-event-opts="{{[['tap',[['increaseQuantity',[index]]]]]}}" class="quantity-btn plus" bindtap="__e">+</view></view></view></block></scroll-view></view><view data-event-opts="{{[['tap',[['e4',['$event']]]]]}}" class="cart-detail-mask" bindtap="__e"></view></view></block></block></block></block><ai-assistant vue-id="c1c3f95e-2" bind:__l="__l"></ai-assistant></view>